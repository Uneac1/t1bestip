# CloudFlare IP优选自动化工具

## 功能概述

这个自动化工具会访问 [https://t1.y130.icu/t1/bestip](https://t1.y130.icu/t1/bestip) 网站，自动进行CloudFlare IP优选测试，并执行追加保存操作。

## 测试配置

### 测试组合
- **IP库**：CF官方列表
- **端口**：443（标准HTTPS端口）
- **总组合数**：1个组合

## 自动化流程

### 1. 网站操作流程
对每个组合执行以下步骤：
1. **清除选择**：清除所有已选择的IP库和端口
2. **选择IP库**：选择当前测试的IP库
3. **选择端口**：选择当前测试的端口
4. **开始测试**：点击"开始延迟测试"按钮
5. **等待完成**：等待测试完成（最多5分钟）
6. **追加保存**：点击"追加保存优选IP"按钮
7. **获取结果**：提取测试结果中的IP地址

### 2. 结果处理
- 每个组合的测试结果都会记录
- 成功测试的IP会追加保存到 `ip.txt` 文件
- 记录详细的测试日志和统计信息

## GitHub Actions配置

### 工作流文件
- `.github/workflows/auto-update.yml` - 主要的自动化工作流

### 执行频率
- **每3小时执行一次**（只测试CF官方列表+443端口，时间很短）
- 支持手动触发执行

### 超时设置
- 工作流超时：15分钟
- 单个组合测试超时：5分钟

## 文件说明

### 主要脚本
- `cf_ip_automation.py` - 主要自动化脚本
- `collect_ips.py` - 备用IP收集脚本

### 配置文件
- `requirements.txt` - Python依赖包
- `.github/workflows/` - GitHub Actions工作流配置

## 输出格式

### ip.txt文件格式
```
# 组合测试结果 - 2024-01-01 12:00:00
# 成功测试组合: 1/1
# 总IP数量: 16
# ==================================================

# CF官方列表 + 端口443 (16个IP)
104.18.79.150
104.16.226.60
162.159.48.156
104.17.95.64
104.18.10.213
...
```

## 使用方法

### 本地运行
```bash
# 安装依赖
pip install -r requirements.txt

# 安装Chrome和ChromeDriver
# 确保Chrome浏览器已安装并下载对应版本的ChromeDriver

# 运行自动化脚本
python cf_ip_automation.py
```

### GitHub Actions
1. 将代码推送到GitHub仓库
2. 工作流会自动每3小时执行一次
3. 也可以手动触发执行

## 重要注意事项

### 1. 网络环境
- **必须关闭代理/VPN**：确保直连网络环境
- 测试结果在代理环境下不准确

### 2. 执行时间
- 完整测试时间很短（预计3-5分钟）
- 单个组合测试约1-2分钟
- GitHub Actions设置了15分钟超时

### 3. 错误处理
- 单个组合失败不会影响其他组合
- 详细的错误日志记录
- 自动重试机制

### 4. 结果保存
- 使用追加保存模式，不会覆盖现有IP
- 每个组合的结果都会单独记录
- 包含详细的统计信息

## 监控和调试

### 日志输出
脚本会输出详细的执行日志：
- 当前测试的组合
- 测试进度
- 成功/失败状态
- 获取的IP数量

### 结果验证
- 检查 `ip.txt` 文件是否更新
- 查看GitHub Actions执行日志
- 验证IP地址格式和数量

## 故障排除

### 常见问题
1. **ChromeDriver版本不匹配**：确保版本兼容
2. **网站结构变化**：可能需要更新选择器
3. **网络超时**：检查网络连接稳定性
4. **代理检测**：确保未使用代理

### 调试模式
如需查看浏览器操作过程：
```python
# 在 cf_ip_automation.py 中注释掉这行
# chrome_options.add_argument('--headless')
```

## 性能优化

### 极简测试
- 只测试CF官方列表+443端口，极大减少测试时间
- 从30个组合减少到1个组合
- 执行时间从30-45分钟减少到3-5分钟

### 资源使用
- 无头模式运行，节省资源
- 组合间有短暂休息，避免过载

## 扩展功能

### 可添加的功能
1. **结果去重**：自动去除重复IP
2. **延迟排序**：按延迟时间排序
3. **质量筛选**：只保存高质量IP
4. **通知功能**：测试完成后发送通知

### 自定义配置
- 修改IP库和端口列表
- 调整测试超时时间
- 自定义结果保存格式
