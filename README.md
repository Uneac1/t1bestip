# CloudFlare IP优选自动化工具

这是一个用于自动获取CloudFlare优选IP的工具。它通过GitHub Actions定时访问在线优选IP网站，执行测试并保存结果。

## 🌟 主要功能

- **自动化IP优选**：每3小时自动访问 [https://t1.y130.icu/t1/bestip](https://t1.y130.icu/t1/bestip) 网站，测试CF官方列表的443端口IP
- **智能等待机制**：每10秒检查测试完成状态，避免盲目等待
- **真实测试结果**：获取网站实际测试的统计信息、测试进度和IP列表
- **结果追加保存**：将优选出的IP地址追加保存到 `ip.txt` 文件中
- **GitHub Actions集成**：通过GitHub Actions实现完全自动化，无需手动干预

## 📁 文件结构

```
cfipcaiji-main/
├── cf_ip_automation.py          # 主要自动化脚本
├── collect_ips.py               # 备用IP收集脚本
├── requirements.txt             # Python依赖包
├── README.md                    # 主说明文档
├── COMBINATIONS_AUTOMATION.md   # 详细使用说明和故障排除
├── ip.txt                       # 优选IP输出文件
└── .github/
    └── workflows/
        └── auto-update.yml      # GitHub Actions工作流配置
```

## 🚀 使用方法

### GitHub Actions（推荐）

1. **Fork此仓库**到您的GitHub账户
2. **启用GitHub Actions**：在仓库设置中确保Actions已启用
3. **自动执行**：工作流会自动每3小时执行一次
4. **手动触发**：也可以在GitHub Actions页面手动触发执行

### 本地运行

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **安装Chrome浏览器**（仅本地运行需要）

3. **运行脚本**：
   ```bash
   python cf_ip_automation.py
   ```

## 📊 输出格式

脚本会在 `ip.txt` 文件中保存以下格式的结果：

```
# CF官方列表优选IP - 2025-10-16 15:25:22
# 统计信息: 您的国家: CN 获取到的IP总数: 16
# 测试进度: 测试完成
# ==================================================
104.18.79.150
104.16.226.60
162.159.48.156
104.17.95.64
104.18.10.213
...
```

## ⚙️ 技术特点

- **精确选择器**：基于真实网站HTML结构，使用ID选择器确保准确性
- **智能状态检查**：检查当前选中值，避免重复操作
- **容错处理**：详细的错误信息和调试输出
- **环境自适应**：本地环境跳过Chrome，GitHub Actions环境使用Chrome
- **真实数据**：只保存网站实际测试的结果，不生成假数据

## 🔧 配置说明

### GitHub Actions工作流

- **执行频率**：每3小时执行一次（`0 */3 * * *`）
- **超时时间**：15分钟
- **Chrome版本**：自动安装匹配的Chrome和ChromeDriver
- **Python版本**：3.9

### 脚本配置

- **测试组合**：CF官方列表 + 443端口
- **等待策略**：每10秒检查测试完成状态
- **最大等待**：5分钟
- **结果限制**：前16个优选IP

## 📋 依赖包

- `selenium==4.15.0` - 浏览器自动化
- `requests==2.31.0` - HTTP请求
- `beautifulsoup4==4.12.0` - HTML解析

## 🐛 故障排除

### 常见问题

1. **ChromeDriver版本不匹配**
   - 解决方案：脚本会自动安装匹配的ChromeDriver版本

2. **网站元素找不到**
   - 解决方案：脚本基于真实网站结构，使用精确的ID选择器

3. **测试超时**
   - 解决方案：脚本会每10秒检查状态，最多等待5分钟

4. **IP列表为空**
   - 解决方案：确保网络连接正常，网站可正常访问

### 调试模式

在本地运行脚本时，会输出详细的调试信息，包括：
- 当前选中的IP库和端口
- 测试进度状态
- IP列表原始文本
- 错误详情

## 📈 性能优化

- **极简测试**：只测试CF官方列表的443端口，减少执行时间
- **智能等待**：根据实际测试进度调整等待时间
- **资源节约**：使用headless模式，减少资源消耗

## 🔄 更新日志

- **v1.0.0** - 初始版本，支持基本的IP优选功能
- **v1.1.0** - 添加GitHub Actions集成
- **v1.2.0** - 优化选择器，基于真实网站结构
- **v1.3.0** - 添加智能等待机制和详细调试信息

## 📞 支持

如果您遇到问题或有建议，请：
1. 查看 `COMBINATIONS_AUTOMATION.md` 获取详细说明
2. 检查GitHub Actions日志
3. 在本地运行脚本查看调试信息

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**注意**：此工具仅用于学习和研究目的，请遵守相关网站的使用条款。
